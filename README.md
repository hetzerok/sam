# SAM (StandAlone Migrations)

## Описание
Компонент предназначен для создания и управления миграциями БД без зависимости от какого-либо фреймворка. 
Поддерживает MySQL 5.5+, использует PHP 5.4+. Позволяет используя привычные инструменты работать MySQL, а затем на 
основе существующей таблицы генерировать файлы миграций.

## Установка и настройка
1) Скачайте файлы компонента или клонируйте репозиторий.
2) Запустите команду `composer update` чтобы установить зависимости.
3) На основе файла `config.inc.sample.php` создайте файл `config.inc.php`, используя свои настройки.
4) ...profit

## Комады
Для работы с CLI требуется выполнить файл `run.php` через консоль. При запуске будет показан набор доступных команд.
+ `migrations:migrate` - инициализация системы миграций и создание первой миграции.
+ `migrations:generate` - создание миграции (кроме инициилизирующей)
+ `migrations:migrate` - применение миграций. Принимает опцию `--last`, при помощи которой передаётся ключ последней 
накатываемой миграции.

## Схема работы
Вы устанавливаете компонент, инициализируете систему командой `migrations:initialize`, вносите изменения в бд любым 
удобным вам способом. Когда приходит момент зафиксировать этап разработки используете команду `migrations:generate`. 
Миграции можно хранить с помощью VCS или передавать любым удобным способом. При возникновении необходимости обновить
структуру используется команда `migrations:migrate`.

## .gitignore
Если используется VCS GIT, то рекомендую настроить ваш `.gitignore` файл соответствующим образом. 
В общем случае игнорируйте файл `/config/config.inc.php`, файл `/db/migrations/local.schema.json` и файл 
`/db/schemas/local.schema.json`. Местоположение и названия этих файлов могут меняться согласно конфига.

## Фичи и баги
+ Будут учтены только таблицы с префиксом, который указан в конфиге, если не хотите использовать префикс укажите в 
качестве значения настройки `table_prefix` пустую строку. 
+ Для того чтобы иметь возможность переименовывать таблицы и столбцы добавляйте к ним комментарий. Пример: вы хотите 
переименовать таблицу `users` в `my_users`. В начале добавьте комментарий к таблице (любой), выполните команду
`migrations:generate` затем переименуйте таблицу и вновь выполните `migrations:generate` в противном случае будет
произведено удаление таблицы `users` и создание таблицы `my_users`.
